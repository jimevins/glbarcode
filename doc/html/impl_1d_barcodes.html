<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.3.1"/>
<title>glbarcode++: Implementing 1D Barcodes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="glbarcode_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">glbarcode++
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('impl_1d_barcodes.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Implementing 1D Barcodes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Creating new 1D barcode types (or symbologies) is accomplished by implementing a subclass of the abstract <a class="el" href="classglbarcode_1_1Barcode1dBase.html">glbarcode::Barcode1dBase</a> class which is a subclass of the <a class="el" href="classglbarcode_1_1Barcode.html">glbarcode::Barcode</a> class.</p>
<div align="center">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"><area shape="rect" id="node1" href="classglbarcode_1_1Barcode.html" title="glbarcode::Barcode" alt="" coords="36,5,167,53"/><area shape="rect" id="node2" href="classglbarcode_1_1Barcode1dBase.html" title="glbarcode::Barcode1dBase" alt="" coords="13,101,189,149"/></map>
</div>
<h2>Virtual Methods</h2>
<p>A 1D barcode subclass must implement the following virtual methods (or callbacks):</p>
<ul>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a117b592f4c19c7c141550c5138976b4a">glbarcode::Barcode1dBase::validate()</a> &ndash; The validate method is used to test if data is valid for encoding with the intended symbology. This method must only validate data that can be encoded successfully as-is or after processing by the optional <a class="el" href="classglbarcode_1_1Barcode1dBase.html#a2c612eae36722c0b326cc999c813f10e">glbarcode::Barcode1dBase::preprocess()</a> method.</li>
</ul>
<ul>
<li><p class="startli"><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a48760e7d2d2189358f388af535dd8317">glbarcode::Barcode1dBase::encode()</a> &ndash; The encode method is used to encode data such that it can later be vectorized. The encoded data is usually a list of characters that represent an atomic barcode element. For example, the following is the character encoding used by the Code39 implementation:</p>
<center> <table class="doxtable">
<tr>
<th align="center">Character </th><th align="left">Meaning </th></tr>
<tr>
<td align="center">N </td><td align="left">A narrow bar. </td></tr>
<tr>
<td align="center">W </td><td align="left">A wide bar. </td></tr>
<tr>
<td align="center">n </td><td align="left">A narrow space (gap between bars) </td></tr>
<tr>
<td align="center">w </td><td align="left">A wide space (gap between bars) </td></tr>
<tr>
<td align="center">i </td><td align="left">Inter-symbol gap </td></tr>
</table>
</center><p class="startli">Other encoding examples can be found in the existing barcode implementations.</p>
</li>
</ul>
<ul>
<li><p class="startli"><a class="el" href="classglbarcode_1_1Barcode1dBase.html#aa83b9227370ce254fec336630ce9188e">glbarcode::Barcode1dBase::vectorize()</a> &ndash; The vectorize method converts the encoded data into a list of <a class="el" href="drawing_primitives.html">Drawing Primitives</a> suitable for rendering. The following protected methods are available to the vectorize implementation to create this list:</p>
<ul>
<li><a class="el" href="classglbarcode_1_1Barcode.html#af84ab5824d0320133066dac885849fe0">glbarcode::Barcode::add_line()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#a5830b7bc56dd2db0e3cdb50cd09a734e">glbarcode::Barcode::add_box()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#ab07ee2f633e093cca65c6009116e285d">glbarcode::Barcode::add_text()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#af32771fa6c76c3c06fd0d2a737af8f8f">glbarcode::Barcode::add_ring()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#ac23d0e6940daf19a96ef18a2f80e6603">glbarcode::Barcode::add_hexagon()</a></li>
</ul>
</li>
</ul>
<p>A barcode subclass may also need to implement the following virtual methods:</p>
<ul>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a2c612eae36722c0b326cc999c813f10e">glbarcode::Barcode1dBase::preprocess()</a> &ndash; The preprocess method performs any transformation of the data needed before encoding. This method may be needed to perform a first-pass encoding to translate an extended alphabet into a simpler one. For example, this could be as simple as upshifting lowercase letters into uppercase if the symbology only supports uppercase. It is assumed that the data passed to this method has already been validated with the <a class="el" href="classglbarcode_1_1Barcode1dBase.html#a117b592f4c19c7c141550c5138976b4a">glbarcode::Barcode1dBase::validate()</a> method.</li>
</ul>
<ul>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a54e0aac18674093ef2a1ef1c8c09193b">glbarcode::Barcode1dBase::prepare_text()</a> &ndash; The prepare_text method performs any transformation of the data needed before it can be displayed.</li>
</ul>
<p>The following figure illustrates the data flow between these methods, which are called by <a class="el" href="classglbarcode_1_1Barcode1dBase.html#acc7fac08d928e4c0c4b191b4ead6adf0">glbarcode::Barcode1dBase::build()</a>:</p>
<div align="center">
<img src="dot_inline_dotgraph_2.png" alt="dot_inline_dotgraph_2.png" border="0" usemap="#dot_inline_dotgraph_2.map"/>
<map name="dot_inline_dotgraph_2.map" id="dot_inline_dotgraph_2.map"><area shape="rect" id="node3" href="classglbarcode_1_1Barcode1dBase.html#a117b592f4c19c7c141550c5138976b4a" title="validate" alt="" coords="89,104,161,152"/><area shape="rect" id="node4" href="classglbarcode_1_1Barcode1dBase.html#a2c612eae36722c0b326cc999c813f10e" title="preprocess" alt="" coords="12,203,97,251"/><area shape="rect" id="node6" href="classglbarcode_1_1Barcode1dBase.html#a54e0aac18674093ef2a1ef1c8c09193b" title="prepare_text" alt="" coords="103,312,196,360"/><area shape="rect" id="node5" href="classglbarcode_1_1Barcode1dBase.html#a48760e7d2d2189358f388af535dd8317" title="encode" alt="" coords="5,312,77,360"/><area shape="rect" id="node7" href="classglbarcode_1_1Barcode1dBase.html#aa83b9227370ce254fec336630ce9188e" title="vectorize" alt="" coords="60,421,132,469"/></map>
</div>
<h2>Registering With The Barcode Factory</h2>
<p>To be able to register a barcode type with the barcode factory, it must implement a static create method that returns a pointer to a newly allocated barcode:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>glbarcode;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classglbarcode_1_1Barcode.html">Barcode</a>* BarcodeXxx::create( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> BarcodeXxx();</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is used to register the barcode using <a class="el" href="classglbarcode_1_1BarcodeFactory.html#a5cdcd088bef0d79be275264d8738897f">glbarcode::BarcodeFactory::register_type</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>glbarcode;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classglbarcode_1_1BarcodeFactory.html#a5cdcd088bef0d79be275264d8738897f">BarcodeFactory::register_type</a>( <span class="stringliteral">&quot;xxx&quot;</span>, &amp;BarcodeXxx::create )</div>
</div><!-- fragment --><h2>Full Example</h2>
<p>As a complete example, the following is the glbarcode++ implementation of the Code39 barcode type.</p>
<p><a class="el" href="BarcodeCode39_8h.html">BarcodeCode39.h</a>: </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*  BarcodeCode39.h</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Copyright (C) 2013  Jim Evins &lt;evins@snaught.com&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  This file is part of glbarcode++.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  glbarcode++ is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *  (at your option) any later version.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  glbarcode++ is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  GNU Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *  along with glbarcode++.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#ifndef glbarcode_BarcodeCode39_h</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor"></span><span class="preprocessor">#define glbarcode_BarcodeCode39_h</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Barcode1dBase_8h.html">Barcode1dBase.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">namespace </span>glbarcode</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;{</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;        <span class="keyword">class </span>BarcodeCode39 : <span class="keyword">public</span> Barcode1dBase</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keyword">public</span>:</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                <span class="keyword">static</span> <a class="code" href="classglbarcode_1_1Barcode.html#a99edd197081eea1997b4391d37db3009">Barcode</a>* <a class="code" href="classglbarcode_1_1BarcodeCode39.html#a29b1bbece77066ffb1033e83339758e9">create</a>( <span class="keywordtype">void</span> );</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keyword">private</span>:</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                <span class="keywordtype">bool</span> validate( std::string raw_data );</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                std::string encode( std::string cooked_data );</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                std::string prepare_text( std::string raw_data );</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                <span class="keywordtype">void</span> vectorize( std::string coded_data,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                                std::string display_text,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                std::string cooked_data,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                <span class="keywordtype">double</span>      &amp;w,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                <span class="keywordtype">double</span>      &amp;h );</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        };</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;}</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="preprocessor">#endif // glbarcode_BarcodeCode39_h</span></div>
</div><!-- fragment --><p><a class="el" href="BarcodeCode39_8cpp.html">BarcodeCode39.cpp</a>: </p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/*  BarcodeCode39.cpp</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> *  Copyright (C) 2013  Jim Evins &lt;evins@snaught.com&gt;</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> *  This file is part of glbarcode++.</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> *  glbarcode++ is free software: you can redistribute it and/or modify</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> *  it under the terms of the GNU Lesser General Public License as published by</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> *  the Free Software Foundation, either version 3 of the License, or</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> *  (at your option) any later version.</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> *  glbarcode++ is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> *  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> *  GNU Lesser General Public License for more details.</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> *  You should have received a copy of the GNU Lesser General Public License</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> *  along with glbarcode++.  If not, see &lt;http://www.gnu.org/licenses/&gt;.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="BarcodeCode39_8h.html">BarcodeCode39.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">Constants.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &lt;cctype&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using namespace </span>glbarcode::Constants;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">namespace</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;        <span class="comment">/* Code 39 alphabet. Position indicates value. */</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        <span class="keyword">const</span> std::string alphabet = <span class="stringliteral">&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%&quot;</span>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;        <span class="comment">/* Code 39 symbols. Position must match position in alphabet. */</span></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;        <span class="keyword">const</span> std::string symbols[] = {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                <span class="comment">/*        BsBsBsBsB */</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                <span class="comment">/* 0 */</span>  <span class="stringliteral">&quot;NnNwWnWnN&quot;</span>,</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                <span class="comment">/* 1 */</span>  <span class="stringliteral">&quot;WnNwNnNnW&quot;</span>,</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                <span class="comment">/* 2 */</span>  <span class="stringliteral">&quot;NnWwNnNnW&quot;</span>,</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                <span class="comment">/* 3 */</span>  <span class="stringliteral">&quot;WnWwNnNnN&quot;</span>,</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                <span class="comment">/* 4 */</span>  <span class="stringliteral">&quot;NnNwWnNnW&quot;</span>,</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                <span class="comment">/* 5 */</span>  <span class="stringliteral">&quot;WnNwWnNnN&quot;</span>,</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                <span class="comment">/* 6 */</span>  <span class="stringliteral">&quot;NnWwWnNnN&quot;</span>,</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                <span class="comment">/* 7 */</span>  <span class="stringliteral">&quot;NnNwNnWnW&quot;</span>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                <span class="comment">/* 8 */</span>  <span class="stringliteral">&quot;WnNwNnWnN&quot;</span>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                <span class="comment">/* 9 */</span>  <span class="stringliteral">&quot;NnWwNnWnN&quot;</span>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                <span class="comment">/* A */</span>  <span class="stringliteral">&quot;WnNnNwNnW&quot;</span>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                <span class="comment">/* B */</span>  <span class="stringliteral">&quot;NnWnNwNnW&quot;</span>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                <span class="comment">/* C */</span>  <span class="stringliteral">&quot;WnWnNwNnN&quot;</span>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                <span class="comment">/* D */</span>  <span class="stringliteral">&quot;NnNnWwNnW&quot;</span>,</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                <span class="comment">/* E */</span>  <span class="stringliteral">&quot;WnNnWwNnN&quot;</span>,</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                <span class="comment">/* F */</span>  <span class="stringliteral">&quot;NnWnWwNnN&quot;</span>,</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                <span class="comment">/* G */</span>  <span class="stringliteral">&quot;NnNnNwWnW&quot;</span>,</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                <span class="comment">/* H */</span>  <span class="stringliteral">&quot;WnNnNwWnN&quot;</span>,</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                <span class="comment">/* I */</span>  <span class="stringliteral">&quot;NnWnNwWnN&quot;</span>,</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;                <span class="comment">/* J */</span>  <span class="stringliteral">&quot;NnNnWwWnN&quot;</span>,</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;                <span class="comment">/* K */</span>  <span class="stringliteral">&quot;WnNnNnNwW&quot;</span>,</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;                <span class="comment">/* L */</span>  <span class="stringliteral">&quot;NnWnNnNwW&quot;</span>,</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;                <span class="comment">/* M */</span>  <span class="stringliteral">&quot;WnWnNnNwN&quot;</span>,</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;                <span class="comment">/* N */</span>  <span class="stringliteral">&quot;NnNnWnNwW&quot;</span>,</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                <span class="comment">/* O */</span>  <span class="stringliteral">&quot;WnNnWnNwN&quot;</span>,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                <span class="comment">/* P */</span>  <span class="stringliteral">&quot;NnWnWnNwN&quot;</span>,</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="comment">/* Q */</span>  <span class="stringliteral">&quot;NnNnNnWwW&quot;</span>,</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                <span class="comment">/* R */</span>  <span class="stringliteral">&quot;WnNnNnWwN&quot;</span>,</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                <span class="comment">/* S */</span>  <span class="stringliteral">&quot;NnWnNnWwN&quot;</span>,</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="comment">/* T */</span>  <span class="stringliteral">&quot;NnNnWnWwN&quot;</span>,</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <span class="comment">/* U */</span>  <span class="stringliteral">&quot;WwNnNnNnW&quot;</span>,</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="comment">/* V */</span>  <span class="stringliteral">&quot;NwWnNnNnW&quot;</span>,</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                <span class="comment">/* W */</span>  <span class="stringliteral">&quot;WwWnNnNnN&quot;</span>,</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <span class="comment">/* X */</span>  <span class="stringliteral">&quot;NwNnWnNnW&quot;</span>,</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="comment">/* Y */</span>  <span class="stringliteral">&quot;WwNnWnNnN&quot;</span>,</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                <span class="comment">/* Z */</span>  <span class="stringliteral">&quot;NwWnWnNnN&quot;</span>,</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                <span class="comment">/* - */</span>  <span class="stringliteral">&quot;NwNnNnWnW&quot;</span>,</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                <span class="comment">/* . */</span>  <span class="stringliteral">&quot;WwNnNnWnN&quot;</span>,</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="comment">/*   */</span>  <span class="stringliteral">&quot;NwWnNnWnN&quot;</span>,</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;                <span class="comment">/* $ */</span>  <span class="stringliteral">&quot;NwNwNwNnN&quot;</span>,</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                <span class="comment">/* / */</span>  <span class="stringliteral">&quot;NwNwNnNwN&quot;</span>,</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                <span class="comment">/* + */</span>  <span class="stringliteral">&quot;NwNnNwNwN&quot;</span>,</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="comment">/* % */</span>  <span class="stringliteral">&quot;NnNwNwNwN&quot;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        };</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        <span class="keyword">const</span> std::string frame_symbol = <span class="stringliteral">&quot;NwNnWnWnN&quot;</span>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;        <span class="comment">/* Vectorization constants */</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_X       = ( 0.01 *  <a class="code" href="namespaceglbarcode_1_1Constants.html#a32cca8097079828307c361ca2fbc9d2c">PTS_PER_INCH</a> );</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> N           = 2.5;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_I       = MIN_X;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_HEIGHT  = ( 0.25 *  <a class="code" href="namespaceglbarcode_1_1Constants.html#a32cca8097079828307c361ca2fbc9d2c">PTS_PER_INCH</a> );</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_QUIET   = ( 0.10 *  <a class="code" href="namespaceglbarcode_1_1Constants.html#a32cca8097079828307c361ca2fbc9d2c">PTS_PER_INCH</a> );</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_TEXT_AREA_HEIGHT = 14.0;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_TEXT_SIZE        = 10.0;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;}</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="keyword">namespace </span>glbarcode</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;{</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">         * Static Code39 barcode creation method</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        Barcode* <a class="code" href="classglbarcode_1_1BarcodeCode39.html#a29b1bbece77066ffb1033e83339758e9">BarcodeCode39::create</a>( <span class="keywordtype">void</span> )</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">new</span> BarcodeCode39();</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        }</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">         * Code39 data validation, implements Barcode::validate()</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        <span class="keywordtype">bool</span> BarcodeCode39::validate( std::string raw_data )</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; raw_data.size(); i++ )</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                {</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                        <span class="keywordtype">char</span> c = toupper( raw_data[i] );</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                        <span class="keywordflow">if</span> ( alphabet.find(c) == std::string::npos )</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                        {</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                        }</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">         * Code39 data encoding, implements Barcode::encode()</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        std::string BarcodeCode39::encode( std::string cooked_data )</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                std::string code;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="comment">/* Left frame symbol */</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                code += frame_symbol;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                code += <span class="stringliteral">&quot;i&quot;</span>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="keywordtype">int</span> sum = 0;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i &lt; cooked_data.size(); i++ )</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                {</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                        <span class="keywordtype">int</span> c_value = alphabet.find( toupper( cooked_data[i] ) );</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                        code += symbols[c_value];</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                        code += <span class="stringliteral">&quot;i&quot;</span>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                        sum += c_value;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                }</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="keywordflow">if</span> ( checksum() )</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                        code += symbols[sum % 43];</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                        code += <span class="stringliteral">&quot;i&quot;</span>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                <span class="comment">/* Right frame bar */</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                code += frame_symbol;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keywordflow">return</span> code;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">         * Code39 prepare text for display, implements Barcode::prepare_text()</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        std::string BarcodeCode39::prepare_text( std::string raw_data )</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                std::string display_text;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; raw_data.size(); i++ )</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                        display_text += toupper( raw_data[i] );</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">return</span> display_text;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        }</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;        <span class="comment">/*</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;<span class="comment">         * Code39 vectorization, implements Barcode::vectorize()</span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;        <span class="keywordtype">void</span> BarcodeCode39::vectorize( std::string coded_data,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                       std::string display_text,</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                       std::string cooked_data,</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                       <span class="keywordtype">double</span>      &amp;w,</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                       <span class="keywordtype">double</span>      &amp;h )</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;        {</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <span class="comment">/* determine width and establish horizontal scale, based on original cooked data */</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keywordtype">double</span> data_size = cooked_data.size();</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="keywordtype">double</span> min_l;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <span class="keywordflow">if</span> ( !checksum() )</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                {</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                        min_l = (data_size + 2)*(3*N + 6)*MIN_X + (data_size + 1)*MIN_I;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                }</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                        min_l = (data_size + 3)*(3*N + 6)*MIN_X + (data_size + 2)*MIN_I;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;        </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="keywordtype">double</span> scale;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                <span class="keywordflow">if</span> ( w == 0 )</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                        scale = 1.0;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                }</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                        scale = w / (min_l + 2*MIN_QUIET);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                        <span class="keywordflow">if</span> ( scale &lt; 1.0 )</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                        {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                scale = 1.0;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                        }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <span class="keywordtype">double</span> width = min_l * scale;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="comment">/* determine text parameters */</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                <span class="keywordtype">double</span> h_text_area = scale * MIN_TEXT_AREA_HEIGHT;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                <span class="keywordtype">double</span> text_size   = scale * MIN_TEXT_SIZE;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="comment">/* determine height of barcode */</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="keywordtype">double</span> height = show_text() ? h - h_text_area : h;</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                height = std::max( height, std::max( 0.15*width, MIN_HEIGHT ) );</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                <span class="comment">/* determine horizontal quiet zone */</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordtype">double</span> x_quiet = std::max( (10 * scale * MIN_X), MIN_QUIET );</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                <span class="comment">/* Now traverse the code string and draw each bar */</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordtype">double</span> x1 = x_quiet;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i &lt; coded_data.size(); i++ )</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                {</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                        <span class="keywordtype">double</span> lwidth;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                </div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                        <span class="keywordflow">switch</span> ( coded_data[i] )</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;                        {</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                        <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                                <span class="comment">/* Inter-character gap */</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                                x1 += scale * MIN_I;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                        <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                                <span class="comment">/* Narrow bar */</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                                lwidth = scale*MIN_X;</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                                add_line( x1, 0.0, lwidth, height );</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                                x1 += scale * MIN_X;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                        <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>:</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                <span class="comment">/* Wide bar */</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                lwidth = scale*N*MIN_X;</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                                add_line( x1, 0.0, lwidth, height );</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                                x1 += scale * N * MIN_X;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                        <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                                <span class="comment">/* Narrow space */</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                                x1 += scale * MIN_X;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                                <span class="comment">/* Wide space */</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                                x1 += scale * N * MIN_X;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                                <span class="comment">// NOT REACHED</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                <span class="keywordflow">if</span> ( show_text() )</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                {</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                        std::string starred_text = <span class="stringliteral">&quot;*&quot;</span> + display_text + <span class="stringliteral">&quot;*&quot;</span>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                        add_text( x_quiet + width/2, height + (h_text_area+0.7*text_size)/2, text_size, starred_text );</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                }</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="comment">/* Overwrite requested size with actual size. */</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                w = width + 2*x_quiet;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                h = show_text() ? height + h_text_area : height;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        }</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;}</div>
</div><!-- fragment --><p>Finally, as a built-in barcode type, the Code39 barcode type is registered in the glbarcode::BarcodeFactory::init() method using the <a class="el" href="classglbarcode_1_1BarcodeFactory.html#a5cdcd088bef0d79be275264d8738897f">glbarcode::BarcodeFactory::register_type()</a> method:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="BarcodeCode39_8h.html">glbarcode/BarcodeCode39.h</a>&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">namespace </span>glbarcode</div>
<div class="line">{</div>
<div class="line">        ...</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">void</span> BarcodeFactory::init( <span class="keywordtype">void</span> )</div>
<div class="line">        {</div>
<div class="line">                <a class="code" href="classglbarcode_1_1BarcodeFactory.html#a5cdcd088bef0d79be275264d8738897f">register_type</a>( <span class="stringliteral">&quot;code39&quot;</span>,      &amp;<a class="code" href="classglbarcode_1_1BarcodeCode39.html#a29b1bbece77066ffb1033e83339758e9">BarcodeCode39::create</a> );</div>
<div class="line">                ...</div>
<div class="line">        }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Thu Sep 5 2013 23:44:45 for glbarcode++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.3.1 </li>
  </ul>
</div>
</body>
</html>
