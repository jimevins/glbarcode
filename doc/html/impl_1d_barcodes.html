<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>glbarcode++: Implementing 1D Barcodes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="glbarcode_manual.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">glbarcode++
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('impl_1d_barcodes.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Implementing 1D Barcodes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All barcode implementations are derived from the abstract <a class="el" href="classglbarcode_1_1Barcode.html">glbarcode::Barcode</a> class. The <a class="el" href="classglbarcode_1_1Barcode1dBase.html">glbarcode::Barcode1dBase</a> subclass of <a class="el" href="classglbarcode_1_1Barcode.html">glbarcode::Barcode</a> provides a common framework for the implementation of 1D barcodes. Therefore, creating new 1D barcode types (or symbologies) would be typically accomplished by implementing a subclass of this <a class="el" href="classglbarcode_1_1Barcode1dBase.html">glbarcode::Barcode1dBase</a> class rather than directly implementing the <a class="el" href="classglbarcode_1_1Barcode.html">glbarcode::Barcode</a> class.</p>
<div align="center">
<img src="dot_inline_dotgraph_1.png" alt="dot_inline_dotgraph_1.png" border="0" usemap="#dot_inline_dotgraph_1.map"/>
<map name="dot_inline_dotgraph_1.map" id="dot_inline_dotgraph_1.map"><area shape="rect" id="node1" href="classglbarcode_1_1Barcode.html" title="glbarcode::Barcode" alt="" coords="31,5,137,53"/><area shape="rect" id="node2" href="classglbarcode_1_1Barcode1dBase.html" title="glbarcode::Barcode1dBase" alt="" coords="15,101,153,149"/></map>
</div>
<h2>Virtual Methods </h2>
<p>A 1D barcode subclass must implement the following virtual methods (or callbacks):</p>
<ul>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a1c6f47f7b8911a71073b87a2f19e026e">glbarcode::Barcode1dBase::validate()</a> &ndash; The validate method is used to test if data is valid for encoding with the intended symbology. This method must only validate data that can be encoded successfully as-is or after processing by the optional <a class="el" href="classglbarcode_1_1Barcode1dBase.html#a79813546dbfd2490d43d25a40526c773">glbarcode::Barcode1dBase::preprocess()</a> method.</li>
<li><p class="startli"><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a9bb923ea81efd9e9a96ef6a831a3e532">glbarcode::Barcode1dBase::encode()</a> &ndash; The encode method is used to encode data such that it can later be vectorized. The encoded data is usually a list of characters that represent an atomic barcode element. For example, the following is the character encoding used by the Code39 implementation:</p>
<center> <table class="doxtable">
<tr>
<th align="center">Character </th><th align="left">Meaning  </th></tr>
<tr>
<td align="center">N </td><td align="left">A narrow bar. </td></tr>
<tr>
<td align="center">W </td><td align="left">A wide bar. </td></tr>
<tr>
<td align="center">n </td><td align="left">A narrow space (gap between bars) </td></tr>
<tr>
<td align="center">w </td><td align="left">A wide space (gap between bars) </td></tr>
<tr>
<td align="center">i </td><td align="left">Inter-symbol gap </td></tr>
</table>
</center><p class="startli">Other encoding examples can be found in the existing barcode implementations.</p>
</li>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#aecc99b18d9c6e70a5f32057a4dbd526e">glbarcode::Barcode1dBase::vectorize()</a> &ndash; The vectorize method converts the encoded data into a list of <a class="el" href="drawing_primitives.html">Drawing Primitives</a> suitable for rendering. The following protected methods are available to the vectorize implementation to create this list:<ul>
<li><a class="el" href="classglbarcode_1_1Barcode.html#a85e96f399ed1938e735e678a7a0342b5">glbarcode::Barcode::addLine()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#a789b63b79d0947912d71c396003bc49c">glbarcode::Barcode::addBox()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#aa5e0d48a7639e021a1d90fe7a27b0aac">glbarcode::Barcode::addText()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#af945ebe57f5ea500ff346aa78a9b28d5">glbarcode::Barcode::addRing()</a></li>
<li><a class="el" href="classglbarcode_1_1Barcode.html#a4ac4f85386e6829475c2f9ffb3d2e24a">glbarcode::Barcode::addHexagon()</a></li>
</ul>
</li>
</ul>
<p>A barcode subclass may also need to implement the following virtual methods:</p>
<ul>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#a79813546dbfd2490d43d25a40526c773">glbarcode::Barcode1dBase::preprocess()</a> &ndash; The preprocess method performs any transformation of the data needed before encoding. This method may be needed to perform a first-pass encoding to translate an extended alphabet into a simpler one. For example, this could be as simple as upshifting lowercase letters into uppercase if the symbology only supports uppercase. It is assumed that the data passed to this method has already been validated with the <a class="el" href="classglbarcode_1_1Barcode1dBase.html#a1c6f47f7b8911a71073b87a2f19e026e">glbarcode::Barcode1dBase::validate()</a> method.</li>
<li><a class="el" href="classglbarcode_1_1Barcode1dBase.html#ab02808b25886e1c9fbe2887708bbfba8">glbarcode::Barcode1dBase::prepareText()</a> &ndash; The prepareText method performs any transformation of the data needed before it can be displayed.</li>
</ul>
<p>The following figure illustrates the data flow between these methods, which are called by <a class="el" href="classglbarcode_1_1Barcode1dBase.html#addbe0524d5b6e8afeb9967ca6ad37ee7">glbarcode::Barcode1dBase::build()</a>:</p>
<p><div class="dotgraph">
<img src="dot_figure-1d-build.png" alt="dot_figure-1d-build.png" border="0" usemap="#dot_figure-1d-build.map"/>
<map name="dot_figure-1d-build.map" id="dot_figure-1d-build.map"><area shape="rect" id="node3" href="classglbarcode_1_1Barcode1dBase.html#a1c6f47f7b8911a71073b87a2f19e026e" title="validate()" alt="" coords="79,104,151,152"/><area shape="rect" id="node4" href="classglbarcode_1_1Barcode1dBase.html#a79813546dbfd2490d43d25a40526c773" title="preprocess()" alt="" coords="14,203,89,251"/><area shape="rect" id="node6" href="classglbarcode_1_1Barcode1dBase.html#ab02808b25886e1c9fbe2887708bbfba8" title="prepareText()" alt="" coords="101,312,183,360"/><area shape="rect" id="node5" href="classglbarcode_1_1Barcode1dBase.html#a9bb923ea81efd9e9a96ef6a831a3e532" title="encode()" alt="" coords="5,312,77,360"/><area shape="rect" id="node7" href="classglbarcode_1_1Barcode1dBase.html#aecc99b18d9c6e70a5f32057a4dbd526e" title="vectorize()" alt="" coords="53,421,125,469"/></map>
<div class="caption">
1D build() data flow</div>
</div>
</p>
<h2>Registering With The Barcode Factory </h2>
<p>To be able to register a barcode type with the barcode factory, it must implement a static create method that returns a pointer to a newly allocated barcode:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>glbarcode;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classglbarcode_1_1Barcode.html">Barcode</a>* BarcodeXxx::create( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> BarcodeXxx();</div>
<div class="line">}</div>
</div><!-- fragment --><p>This is used to register the barcode using <a class="el" href="classglbarcode_1_1Factory.html#a17a0dc24fed9af1924fe7e4b59ee651b">glbarcode::Factory::registerType</a>:</p>
<div class="fragment"><div class="line"><span class="keyword">using namespace </span>glbarcode;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="classglbarcode_1_1Factory.html#a17a0dc24fed9af1924fe7e4b59ee651b">Factory::registerType</a>( <span class="stringliteral">&quot;xxx&quot;</span>, &amp;BarcodeXxx::create )</div>
</div><!-- fragment --><h2>Full Example </h2>
<p>As a complete example, the following is the glbarcode++ implementation of a custom barcode type called "mybarcode".</p>
<p>MyBarcode.h: </p>
<div class="fragment"><div class="line"><span class="comment">/*  MyBarcode.h */</span></div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#ifndef _MyBarcode_h_</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#define _MyBarcode_h_</span></div>
<div class="line"><span class="preprocessor"></span>        </div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="Barcode1dBase_8h.html">glbarcode/Barcode1dBase.h</a>&quot;</span></div>
<div class="line">         </div>
<div class="line">         </div>
<div class="line"><span class="keyword">class </span>MyBarcode : <span class="keyword">public</span> <a class="code" href="classglbarcode_1_1Barcode1dBase.html">glbarcode::Barcode1dBase</a></div>
<div class="line">{</div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line">        <span class="keyword">static</span> <a class="code" href="classglbarcode_1_1Barcode.html">glbarcode::Barcode</a>* create( <span class="keywordtype">void</span> );</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line">        <span class="keywordtype">bool</span> <a class="code" href="classglbarcode_1_1Barcode1dBase.html#a1c6f47f7b8911a71073b87a2f19e026e">validate</a>( <span class="keyword">const</span> std::string&amp; rawData );</div>
<div class="line">        </div>
<div class="line">        std::string <a class="code" href="classglbarcode_1_1Barcode1dBase.html#a9bb923ea81efd9e9a96ef6a831a3e532">encode</a>( <span class="keyword">const</span> std::string&amp; cookedData );</div>
<div class="line">        </div>
<div class="line">        std::string <a class="code" href="classglbarcode_1_1Barcode1dBase.html#ab02808b25886e1c9fbe2887708bbfba8">prepareText</a>( <span class="keyword">const</span> std::string&amp; rawData );</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">void</span> <a class="code" href="classglbarcode_1_1Barcode1dBase.html#aecc99b18d9c6e70a5f32057a4dbd526e">vectorize</a>( <span class="keyword">const</span> std::string&amp; codedData,</div>
<div class="line">                        <span class="keyword">const</span> std::string&amp; displayText,</div>
<div class="line">                        <span class="keyword">const</span> std::string&amp; cookedData,</div>
<div class="line">                        <span class="keywordtype">double</span>&amp;            w,</div>
<div class="line">                        <span class="keywordtype">double</span>&amp;            h );</div>
<div class="line">};</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* _MyBarcode_h_ */</span><span class="preprocessor"></span></div>
</div><!-- fragment --><p>MyBarcode.cpp: </p>
<div class="fragment"><div class="line"><span class="comment">/*  MyBarcode.cpp */</span></div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#include &quot;MyBarcode.h&quot;</span></div>
<div class="line">         </div>
<div class="line"><span class="preprocessor">#include &quot;<a class="code" href="Constants_8h.html">glbarcode/Constants.h</a>&quot;</span></div>
<div class="line">         </div>
<div class="line"><span class="preprocessor">#include &lt;cctype&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line">         </div>
<div class="line">         </div>
<div class="line"><span class="keyword">using namespace </span>glbarcode::Constants;</div>
<div class="line">      </div>
<div class="line">      </div>
<div class="line"><span class="comment">/*-----------------------------------*/</span></div>
<div class="line"><span class="comment">/* Private data.                     */</span></div>
<div class="line"><span class="comment">/*-----------------------------------*/</span></div>
<div class="line"><span class="keyword">namespace</span></div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* My barcode alphabet. Position indicates value. */</span></div>
<div class="line">        <span class="keyword">const</span> std::string alphabet = <span class="stringliteral">&quot;0123456789ABCDEF&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* My barcode symbols. Position must match position in alphabet. */</span></div>
<div class="line">        <span class="keyword">const</span> std::string symbols[] = {</div>
<div class="line">                <span class="comment">/*        BsBsBsBsB */</span></div>
<div class="line">                <span class="comment">/* 0 */</span>  <span class="stringliteral">&quot;NnNwWnWnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* 1 */</span>  <span class="stringliteral">&quot;WnNwNnNnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* 2 */</span>  <span class="stringliteral">&quot;NnWwNnNnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* 3 */</span>  <span class="stringliteral">&quot;WnWwNnNnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* 4 */</span>  <span class="stringliteral">&quot;NnNwWnNnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* 5 */</span>  <span class="stringliteral">&quot;WnNwWnNnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* 6 */</span>  <span class="stringliteral">&quot;NnWwWnNnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* 7 */</span>  <span class="stringliteral">&quot;NnNwNnWnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* 8 */</span>  <span class="stringliteral">&quot;WnNwNnWnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* 9 */</span>  <span class="stringliteral">&quot;NnWwNnWnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* A */</span>  <span class="stringliteral">&quot;WnNnNwNnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* B */</span>  <span class="stringliteral">&quot;NnWnNwNnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* C */</span>  <span class="stringliteral">&quot;WnWnNwNnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* D */</span>  <span class="stringliteral">&quot;NnNnWwNnW&quot;</span>,</div>
<div class="line">                <span class="comment">/* E */</span>  <span class="stringliteral">&quot;WnNnWwNnN&quot;</span>,</div>
<div class="line">                <span class="comment">/* F */</span>  <span class="stringliteral">&quot;NnWnWwNnN&quot;</span>,</div>
<div class="line">        };</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">const</span> std::string frameSymbol = <span class="stringliteral">&quot;NwNnWnWnN&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Vectorization constants */</span></div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_X       = ( 0.01 *  <a class="code" href="namespaceglbarcode_1_1Constants.html#a32cca8097079828307c361ca2fbc9d2c">PTS_PER_INCH</a> );</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> N           = 2.5;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_I       = MIN_X;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_HEIGHT  = ( 0.25 *  <a class="code" href="namespaceglbarcode_1_1Constants.html#a32cca8097079828307c361ca2fbc9d2c">PTS_PER_INCH</a> );</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_QUIET   = ( 0.10 *  <a class="code" href="namespaceglbarcode_1_1Constants.html#a32cca8097079828307c361ca2fbc9d2c">PTS_PER_INCH</a> );</div>
<div class="line">        </div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_TEXT_AREA_HEIGHT = 14.0;</div>
<div class="line">        <span class="keyword">const</span> <span class="keywordtype">double</span> MIN_TEXT_SIZE        = 10.0;</div>
<div class="line">}</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* Static barcode creation method                                       */</span></div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><a class="code" href="classglbarcode_1_1Barcode.html">glbarcode::Barcode</a>* MyBarcode::create( <span class="keywordtype">void</span> )</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">new</span> MyBarcode();</div>
<div class="line">}</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* My barcode data validation, implements Barcode1dBase::validate()     */</span></div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="keywordtype">bool</span> MyBarcode::validate( <span class="keyword">const</span> std::string&amp; rawData )</div>
<div class="line">{</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; rawData.size(); i++ )</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordtype">char</span> c = toupper( rawData[i] );</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">if</span> ( alphabet.find(c) == std::string::npos )</div>
<div class="line">                {</div>
<div class="line">                        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line">}</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* My barcode data encoding, implements Barcode1dBase::encode()         */</span></div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line">std::string MyBarcode::encode( <span class="keyword">const</span> std::string&amp; cookedData )</div>
<div class="line">{</div>
<div class="line">        std::string code;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Left frame symbol */</span></div>
<div class="line">        code += frameSymbol;</div>
<div class="line">        code += <span class="stringliteral">&quot;i&quot;</span>;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordtype">int</span> sum = 0;</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i &lt; cookedData.size(); i++ )</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordtype">int</span> cValue = alphabet.find( toupper( cookedData[i] ) );</div>
<div class="line">                </div>
<div class="line">                code += symbols[cValue];</div>
<div class="line">                code += <span class="stringliteral">&quot;i&quot;</span>;</div>
<div class="line">                </div>
<div class="line">                sum += cValue;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> ( checksum() )</div>
<div class="line">        {</div>
<div class="line">                code += symbols[sum % 16];</div>
<div class="line">                code += <span class="stringliteral">&quot;i&quot;</span>;</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Right frame symbol */</span></div>
<div class="line">        code += frameSymbol;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> code;</div>
<div class="line">}</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* Prepare text for display, implements Barcode1dBase::prepareText()    */</span></div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line">std::string MyBarcode::prepareText( <span class="keyword">const</span> std::string&amp; rawData )</div>
<div class="line">{</div>
<div class="line">        std::string displayText;</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; rawData.size(); i++ )</div>
<div class="line">        {</div>
<div class="line">                displayText += toupper( rawData[i] );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">return</span> displayText;</div>
<div class="line">}</div>
<div class="line">        </div>
<div class="line">        </div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="comment">/* My barcode vectorization, implements Barcode1dBase::vectorize()      */</span></div>
<div class="line"><span class="comment">/*----------------------------------------------------------------------*/</span></div>
<div class="line"><span class="keywordtype">void</span> MyBarcode::vectorize( <span class="keyword">const</span> std::string&amp; codedData,</div>
<div class="line">                           <span class="keyword">const</span> std::string&amp; displayText,</div>
<div class="line">                           <span class="keyword">const</span> std::string&amp; cookedData,</div>
<div class="line">                           <span class="keywordtype">double</span>&amp;            w,</div>
<div class="line">                           <span class="keywordtype">double</span>&amp;            h )</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* determine width and establish horizontal scale, based on original cooked data */</span></div>
<div class="line">        <span class="keywordtype">double</span> dataSize = cookedData.size();</div>
<div class="line">        <span class="keywordtype">double</span> minL;</div>
<div class="line">        <span class="keywordflow">if</span> ( !checksum() )</div>
<div class="line">        {</div>
<div class="line">                minL = (dataSize + 2)*(3*N + 6)*MIN_X + (dataSize + 1)*MIN_I;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">                minL = (dataSize + 3)*(3*N + 6)*MIN_X + (dataSize + 2)*MIN_I;</div>
<div class="line">        }</div>
<div class="line">                </div>
<div class="line">        <span class="keywordtype">double</span> scale;</div>
<div class="line">        <span class="keywordflow">if</span> ( w == 0 )</div>
<div class="line">        {</div>
<div class="line">                scale = 1.0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">        {</div>
<div class="line">                scale = w / (minL + 2*MIN_QUIET);</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span> ( scale &lt; 1.0 )</div>
<div class="line">                {</div>
<div class="line">                        scale = 1.0;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordtype">double</span> width = minL * scale;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* determine text parameters */</span></div>
<div class="line">        <span class="keywordtype">double</span> hTextArea = scale * MIN_TEXT_AREA_HEIGHT;</div>
<div class="line">        <span class="keywordtype">double</span> textSize   = scale * MIN_TEXT_SIZE;</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* determine height of barcode */</span></div>
<div class="line">        <span class="keywordtype">double</span> height = showText() ? h - hTextArea : h;</div>
<div class="line">        height = std::max( height, std::max( 0.15*width, MIN_HEIGHT ) );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* determine horizontal quiet zone */</span></div>
<div class="line">        <span class="keywordtype">double</span> xQuiet = std::max( (10 * scale * MIN_X), MIN_QUIET );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Now traverse the code string and draw each bar */</span></div>
<div class="line">        <span class="keywordtype">double</span> x1 = xQuiet;</div>
<div class="line">        <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i=0; i &lt; codedData.size(); i++ )</div>
<div class="line">        {</div>
<div class="line">                <span class="keywordtype">double</span> lwidth;</div>
<div class="line">                                                </div>
<div class="line">                <span class="keywordflow">switch</span> ( codedData[i] )</div>
<div class="line">                {</div>
<div class="line">                </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;i&#39;</span>:</div>
<div class="line">                        <span class="comment">/* Inter-character gap */</span></div>
<div class="line">                        x1 += scale * MIN_I;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;N&#39;</span>:</div>
<div class="line">                        <span class="comment">/* Narrow bar */</span></div>
<div class="line">                        lwidth = scale*MIN_X;</div>
<div class="line">                        addLine( x1, 0.0, lwidth, height );</div>
<div class="line">                        x1 += scale * MIN_X;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;W&#39;</span>:</div>
<div class="line">                        <span class="comment">/* Wide bar */</span></div>
<div class="line">                        lwidth = scale*N*MIN_X;</div>
<div class="line">                        addLine( x1, 0.0, lwidth, height );</div>
<div class="line">                        x1 += scale * N * MIN_X;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;n&#39;</span>:</div>
<div class="line">                        <span class="comment">/* Narrow space */</span></div>
<div class="line">                        x1 += scale * MIN_X;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">case</span> <span class="charliteral">&#39;w&#39;</span>:</div>
<div class="line">                        <span class="comment">/* Wide space */</span></div>
<div class="line">                        x1 += scale * N * MIN_X;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                        </div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                        <span class="comment">// NOT REACHED</span></div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="keywordflow">if</span> ( showText() )</div>
<div class="line">        {</div>
<div class="line">                std::string starredText = <span class="stringliteral">&quot;*&quot;</span> + displayText + <span class="stringliteral">&quot;*&quot;</span>;</div>
<div class="line">                addText( xQuiet + width/2, height + (hTextArea+0.7*textSize)/2, textSize, starredText );</div>
<div class="line">        }</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Overwrite requested size with actual size. */</span></div>
<div class="line">        w = width + 2*xQuiet;</div>
<div class="line">        h = showText() ? height + hTextArea : height;</div>
<div class="line">}</div>
</div><!-- fragment --><p>Now to put it into action.</p>
<p>main.c: </p>
<div class="fragment"><div class="line"><span class="comment">/* main.cpp */</span></div>
<div class="line">   </div>
<div class="line"><span class="preprocessor">#include &quot;MyBarcode.h&quot;</span></div>
<div class="line">         </div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="Factory_8h.html">glbarcode/Factory.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="RendererSvg_8h.html">glbarcode/RendererSvg.h</a>&gt;</span></div>
<div class="line">         </div>
<div class="line"><span class="keyword">using namespace </span>glbarcode;</div>
<div class="line">      </div>
<div class="line"><span class="keywordtype">int</span> main( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv )</div>
<div class="line">{</div>
<div class="line">        <span class="comment">/* Register my barcode with factory. */</span></div>
<div class="line">        <a class="code" href="classglbarcode_1_1Factory.html#a17a0dc24fed9af1924fe7e4b59ee651b">Factory::registerType</a>( <span class="stringliteral">&quot;mybarcode&quot;</span>, MyBarcode::create );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Create barcode object. */</span></div>
<div class="line">        <a class="code" href="classglbarcode_1_1Barcode.html">Barcode</a> *bc = <a class="code" href="classglbarcode_1_1Factory.html#a0aaa36d1132e57934505525cb5438d5e">Factory::createBarcode</a>( <span class="stringliteral">&quot;mybarcode&quot;</span> );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Set barcode options to show text and generate check digit, and then build */</span></div>
<div class="line">        bc-&gt;<a class="code" href="classglbarcode_1_1Barcode.html#a87207581be155a1873899bb6c38897ff">setChecksum</a>(<span class="keyword">true</span>).<a class="code" href="classglbarcode_1_1Barcode.html#a10f90e14d57f6c019c79572102ee79ec">setShowText</a>(<span class="keyword">true</span>).<a class="code" href="classglbarcode_1_1Barcode.html#a4ad4cde8904711940a6060f83cbe79e3">build</a>( <span class="stringliteral">&quot;c0de0016&quot;</span>, 288, 72 );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Render barcode. */</span></div>
<div class="line">        bc-&gt;<a class="code" href="classglbarcode_1_1Barcode.html#ac1a770020b4915e4d324dd18af3a06f5">render</a>( <a class="code" href="classglbarcode_1_1RendererSvg.html">RendererSvg</a>().setFilename( <span class="stringliteral">&quot;MyBarcodeExample.svg&quot;</span> ) );</div>
<div class="line">        </div>
<div class="line">        <span class="comment">/* Cleanup. */</span></div>
<div class="line">        <span class="keyword">delete</span> bc;</div>
<div class="line">}</div>
</div><!-- fragment --><p>This example will produce the following SVG file:</p>
<div class="image">
<img src="MyBarcodeExample.svg" alt="MyBarcodeExample.svg"/>
<div class="caption">
Output of above example 'MyBarcodeExample.svg'</div></div>
 </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Sat Jun 20 2015 20:44:51 for glbarcode++ by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
